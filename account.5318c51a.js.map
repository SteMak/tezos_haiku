{"mappings":"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","sources":["src/js/account.js"],"sourcesContent":["import { TezosToolkit } from \"@taquito/taquito\";\nimport { BeaconWallet } from \"@taquito/beacon-wallet\";\nimport { TezosOperationType } from \"@airgap/beacon-sdk\";\n\nconst Tezos = new TezosToolkit(rpc_addr);\nconst Wallet = new BeaconWallet({ name: \"Tezos Haiku\" });\nTezos.setWalletProvider(Wallet);\n\nTezos.contract.at(contract_addr)\n  .then(contract => {\n    return contract.storage()\n      .then(storage => {\n        assign_data(storage)\n        storage_loaded = true\n        check_wallet()\n      })\n  })\n  .catch(error => console.log(`Error: ${JSON.stringify(error, null, 2)}`));\n\ncheck_wallet = async () => {\n  const activeAccount = await Wallet.client.getActiveAccount();\n  document.getElementById('wallet').style.display = ''\n  if (!activeAccount) {\n    document.getElementById('main_container').innerHTML += '<h2 class=\"fw-light center\">Please, connect your wallet to see your account</h2>'\n  } else {\n    user_addr = activeAccount.address;\n    document.getElementById('wallet').onclick = () => { disconnect_wallet(); document.location.reload() }\n    document.getElementById('wallet').innerHTML = 'Disconnect or change wallet'\n    document.getElementById('main_container').innerHTML = `<h2 class=\"fw-light center\">Created haikus</h2>\n    <div id=\"nothing_crt\">\n      <div id=\"created_tokens\"></div>\n    </div>\n    <div class=\"center\">\n      <button type=\"button\" class=\"btn btn-sm btn-outline-secondary center\" id=\"new_haiku_big_button\">ORIGINATE NEW\n        HAIKU</button>\n    </div>\n    <h2 class=\"fw-light center\">Owned haikus</h2>\n    <div id=\"nothing_own\">\n      <div id=\"owned_tokens\"></div>\n    </div>\n    <div id=\"token_popup\"></div>`\n\n    data_loaded = true\n    main_start()\n  }\n}\n\nconnect_wallet = async () => {\n  const activeAccount = await Wallet.client.getActiveAccount();\n  if (!activeAccount) {\n    const permissions = await Wallet.client.requestPermissions({\n      network: {\n        type: network,\n        rpcUrl: rpc_addr,\n      },\n    });\n    user_addr = permissions.address;\n  } else {\n    user_addr = activeAccount.address;\n  }\n  if (storage_loaded) {\n    document.getElementById('wallet').onclick = () => { disconnect_wallet(); document.location.reload() }\n    document.getElementById('wallet').innerHTML = 'Disconnect or change wallet'\n    document.getElementById('main_container').innerHTML = `<h2 class=\"fw-light center\">Created haikus</h2>\n    <div id=\"nothing_crt\">\n      <div id=\"created_tokens\"></div>\n    </div>\n    <div class=\"center\">\n      <button type=\"button\" class=\"btn btn-sm btn-outline-secondary center\" id=\"new_haiku_big_button\">ORIGINATE NEW\n        HAIKU</button>\n    </div>\n    <h2 class=\"fw-light center\">Owned haikus</h2>\n    <div id=\"nothing_own\">\n      <div id=\"owned_tokens\"></div>\n    </div>\n    <div id=\"token_popup\"></div>`\n\n    data_loaded = true\n    main_start()\n  }\n}\n\ndisconnect_wallet = async () => await Wallet.clearActiveAccount()\n\nconst assign_data = (storage) => {\n  data.tokens = []\n  data.owners = []\n  data.reports = []\n\n  for (const [key, value] of storage.token.valueMap) {\n    value.id = Number(key.slice(1, -1))\n    value.amount = Number(value.amount)\n    value.state = Number(value.state)\n    value.cnfrm_at = new Date(value.cnfrm_at)\n    value.crted_at = new Date(value.crted_at)\n    value.text_color = Number(value.text_color)\n    const c_t = { b: value.text_color % 256 }\n    c_t.g = (value.text_color - c_t.b) / 256 % 256\n    c_t.r = ((value.text_color - c_t.b) / 256 - c_t.g) / 256 % 256\n    value.back_color = Number(value.back_color)\n    const c_b = { b: value.back_color % 256 }\n    c_b.g = (value.back_color - c_b.b) / 256 % 256\n    c_b.r = ((value.back_color - c_b.b) / 256 - c_b.g) / 256 % 256\n    value.image = `<svg class=\"\" width=\"338px\" height=\"225px\" role=\"img\" focusable=\"false\">\n    <rect width=\"100%\" height=\"100%\" fill=\"rgb(${c_b.r},${c_b.g},${c_b.b})\" rx=\"0.25rem\" ry=\"0.25rem\"></rect>\n    <text y=\"20%\" fill=\"white\" font-size=\"1.2em\">\n      ${value.content.split('\\n').reduce((a, c) => a + `<tspan x=\"10%\" dy=\"1.6em\" fill=\"rgb(${c_t.r},${c_t.g},${c_t.b})\">${c}</tspan>`, \"\")}\n    </text>\n  </svg>`\n    data.tokens.push(value)\n  }\n  for (const [s_key, value] of storage.ledger.valueMap) {\n    const key = JSON.parse(s_key)\n    value.token_id = Number(key[1])\n    value.owner = key[0]\n    value.count = Number(value.count)\n    value.for_sale = Number(value.for_sale)\n    value.price = Number(value.price)\n    data.owners.push(value)\n  }\n  for (const [key, value] of storage.report.valueMap) {\n    value.id = Number(key.slice(1, -1))\n    value.rep_t_id = Number(value.rep_t_id)\n    data.reports.push(value)\n  }\n}\n\nconst main_start = () => {\n  if (!dom_loaded || !data_loaded) return\n\n  console.log(data.tokens)\n  console.log(data.owners)\n  console.log(data.reports)\n\n  const created = data.tokens.filter(c => c.creator == user_addr).sort((a, b) => (a.state - b.state) || (b.cnfrm_at - a.cnfrm_at))\n  for (const t of created) {\n    const rep = data.reports.filter(c => c.rep_t_id == t.id)\n    const min_price = data.owners.filter(c => c.token_id == t.id).reduce((a, c) => a > c.price && c.for_sale > 0 ? c.price : a, Infinity)\n    if (\n      t.cnfrm_by.length + t.rejct_by.length >= min_voted_users\n      && Number(t.cnfrm_at) + min_voted_time * 1000 <= Number(new Date())\n      && (\n        rep.reduce((a, c) => a || (c.yes_by.length + c.no_by.length >= min_voted_on_report && c.yes_by.length / (c.yes_by.length + c.no_by.length) >= voted_positive_percent), rep.length == 0)\n        || rep.reduce((a, c) => a && (c.yes_by.length + c.no_by.length >= min_voted_on_report), true)\n      )\n    ) {\n      document.getElementById(\"created_tokens\").innerHTML += `\n        <div class=\"card token\">\n          ${t.image}\n          <div class=\"card-body state_type_${statuses_d[t.state]}\">\n            <p class=\"card-text\">Haiku #${t.id} written by you</p>\n            <div class=\"d-flex justify-content-between align-items-center\">\n              <button type=\"button\" id=\"update_button-${t.id}\" class=\"btn btn-sm btn-outline-secondary verify_button\">VERIFY</button>\n            </div>\n            <p class=\"buy_note\" id=\"note_result-${t.id}\">${!user_addr ? 'Please, connect your wallet to vote for haikus' : ''}</p>\n          </div>\n        </div>`\n    } else {\n      document.getElementById(\"created_tokens\").innerHTML += `\n        <div class=\"card token\" onclick=\"info_open(${t.id})\">\n          ${t.image}\n          <div class=\"card-body state_type_${statuses_d[t.state]}\">\n            <p class=\"card-text\">Haiku #${t.id} written by you</p>\n            <b class=\"card-text\">${min_price !== Infinity ? `Price starts from <a style=\"font-family:monospace;\">${min_price / 1000000}tz</a>` : `Not for sale :(`}</b>\n            <p></p>\n            <div class=\"d-flex justify-content-between align-items-center\">\n              <button type=\"button\" id=\"buy_button-${t.id}\" class=\"btn btn-sm btn-outline-secondary buy_button\">More</button>\n              <small class=\"text-muted\">${t.cnfrm_at.toGMTString().split(', ')[1].slice(0, -7)}</small>\n            </div>\n          </div>\n        </div>`\n    }\n  }\n  if (created.length == 0) {\n    document.getElementById(\"nothing_crt\").innerHTML = `<h3 class=\"fw-light center\">Nothing here :(</h3>`\n  }\n\n  const owner_tokens = data.owners.reduce((a, c) => { if (c.owner == user_addr) a.push(c.token_id); return a }, [])\n  const owned = data.tokens.filter(c => owner_tokens.includes(c.id)).filter(c => c.state <= 1).sort((a, b) => b.cnfrm_at - a.cnfrm_at)\n  for (const t of owned) {\n    const min_price = data.owners.filter(c => c.token_id == t.id).reduce((a, c) => a > c.price && c.for_sale > 0 ? c.price : a, Infinity)\n    document.getElementById(\"owned_tokens\").innerHTML += `<div class=\"card token\" onclick=\"sell_open(${t.id})\">\n      ${t.image}\n      <div class=\"card-body\">\n        <p class=\"card-text\">Haiku #${t.id} written by ${t.creator == user_addr ? `you` : `<a style=\"font-family:monospace; font-size: initial;\">${t.creator}</a>`}</p>\n        <b class=\"card-text\">${min_price !== Infinity ? `Price starts from <a style=\"font-family:monospace;\">${min_price / 1000000}tz</a>` : `Not for sale :(`}</b>\n        <p></p>\n        <div class=\"d-flex justify-content-between align-items-center\">\n          <button type=\"button\" id=\"buy_button-${t.id}\" class=\"btn btn-sm btn-outline-secondary buy_button\">More</button>\n          <small class=\"text-muted\">${t.cnfrm_at.toGMTString().split(', ')[1].slice(0, -7)}</small>\n        </div>\n      </div>\n    </div>`\n  }\n  if (owned.length == 0) {\n    document.getElementById(\"nothing_own\").innerHTML = `<h3 class=\"fw-light center\">Nothing here :(</h3>`\n  }\n}\n\ninfo_open = (id) => {\n  const t = data.tokens[id]\n  document.getElementById('token_popup').innerHTML = `<section id=\"popup_overlay\" class=\"overlay__\">\n    <div class=\"container__\">\n      <h1 class=\"fw-light buy_header\">Info Haiku #${t.id}</h1>\n      <div class=\"card token buy_image\">\n        ${t.image}\n      </div>\n      <div class=\"buy_body\">\n        <div class=\"card buy_card\">Creator: you</div>\n        <div class=\"card buy_card\">Created at: ${t.crted_at.toGMTString().split(', ')[1]}</div>\n        <div class=\"card buy_card\">Status: ${statuses[t.state]}</div>\n        <div class=\"card buy_card\">Total supply: ${t.amount}</div>\n        ${user_addr ? `<div class=\"card buy_card\">You own: ${data.owners.filter(c => c.owner == user_addr && c.token_id == t.id).reduce((a, c) => a + c.count, 0)}</div>` : \"\"}\n        <div class=\"btn-group buy_btn_group\" role=\"group\">\n          <button type=\"button\" onclick=\"token_close()\" class=\"btn btn_secondary buy_cfrm_button\">CLOSE</button>\n        </div>\n      </div>\n    </div>\n  </section>`\n}\nsell_open = (id) => {\n  const t = data.tokens[id]\n  const o = data.owners.filter(c => c.owner == user_addr && c.token_id == id)\n  const max_amount = o.reduce((a, c) => a + c.count, 0)\n  const sale = o.reduce((a, c) => a + c.for_sale, 0)\n  const price = o.reduce((a, c) => a + c.price, 0) / o.length / 1000000\n  document.getElementById('token_popup').innerHTML = `<section id=\"popup_overlay\" class=\"overlay__\">\n    <div class=\"container__\">\n      <h1 class=\"fw-light buy_header\">Update price Haiku #${t.id}</h1>\n      <div class=\"card token buy_image\">\n        ${t.image}\n      </div>\n      <div class=\"buy_body\">\n        <div class=\"card buy_card\">Creator: ${t.creator == user_addr ? `you` : `<a class=\"alien\" href=\"${alien_link}?address=${t.creator}\" target=\"_blank\">${t.creator.slice(0, 7)}...${t.creator.slice(-7)}</a>`}</div>\n        <div class=\"card buy_card\">Created at: ${t.crted_at.toGMTString().split(', ')[1]}</div>\n        <div class=\"card buy_card\">Total supply: ${t.amount}</div>\n        ${user_addr ? `<div class=\"card buy_card\">You own: ${max_amount}</div>` : \"\"}\n        <div class=\"buy_inputs\">\n          <label for=\"sell_amount\" class=\"buy_label\">Choose how many items you want to sell</label>\n          <input type=\"range\" class=\"form_range\" min=\"0\" max=\"${max_amount}\" value=\"${sale}\" step=\"1\" id=\"sell_amount\">\n          <label for=\"sell_price\" class=\"buy_label\">Choose price for these items</label>\n          <input type=\"number\" class=\"form_number\" min=\"0\" value=\"${price}\" step=\"0.1\" id=\"sell_price\">\n        </div>\n        <div class=\"card buy_card\" id=\"sell_samt\">Selected amount to sell: ${sale}</div>\n        <div class=\"card buy_card\" id=\"sell_cost\">Selected price: ${price}tz</div>\n        <div class=\"btn-group buy_btn_group\" role=\"group\">\n          <button type=\"button\" onclick=\"token_close()\" class=\"btn btn_secondary buy_cfrm_button\">CANCEL</button>\n          <button type=\"button\" id=\"sell_cfrm-${t.id}\" class=\"btn btn_primary buy_cfrm_button\">UPDATE PRICE</button>\n        </div>\n        <p class=\"buy_note\" id=\"note_result\"></p>\n      </div>\n    </div>\n  </section>`\n}\nnew_haiku_open = () => {\n  if (storage_loaded) {\n    document.getElementById('token_popup').innerHTML = `<section id=\"popup_overlay\" class=\"overlay__\">\n      <div class=\"container__\">\n        <h1 class=\"fw-light buy_header\">New Haiku Preview</h1>\n        <div class=\"card token buy_image\">\n          <svg class=\"\" width=\"338px\" height=\"225px\" role=\"img\"\n            aria-label=\"Placeholder: Thumbnail\" preserveAspectRatio=\"xMidYMid slice\" focusable=\"false\">\n            <title>Placeholder</title>\n            <rect width=\"100%\" height=\"100%\" fill=\"rgb(0,0,0)\" rx=\"0.25rem\" ry=\"0.25rem\" id=\"canvas\"></rect>\n            <text y=\"20%\" fill=\"rgb(255,255,255)\" font-size=\"1.2em\" id=\"image_text\"></text>\n          </svg>\n        </div>\n        <div class=\"buy_body\">\n          <div class=\"buy_inputs\">\n            <label for=\"mint_c\" class=\"buy_label\">Choose colors of background and text</label>\n            <div class=\"card buy_card\">Backgroung: <input type=\"color\" class=\"form_color\" value=\"#000000\" id=\"mint_c_b\">  Text: <input type=\"color\" class=\"form_color right_empty\" value=\"#ffffff\" id=\"mint_c_t\"></div>\n            <label for=\"mint_amount\" class=\"buy_label\">Choose how many items of haiku you want to mint</label>\n            <input type=\"number\" class=\"form_number\" min=\"1\" max=\"${max_mint_amount}\" value=\"7\" step=\"1\" id=\"mint_amount\">\n            <label for=\"mint_cont\" class=\"buy_label\">Provide yours haiku text below</label>\n            <textarea type=\"text\" class=\"form_haiku_text\" id=\"mint_cont\"></textarea>\n          </div>\n          <div class=\"card buy_card\" id=\"mint_samt\">Selected amount to mint: 7</div>\n          <div class=\"btn-group buy_btn_group\" role=\"group\">\n            <button type=\"button\" onclick=\"token_close()\" class=\"btn btn_secondary buy_cfrm_button\">CANCEL</button>\n            ${user_addr ? `<button type=\"button\" id=\"publish\" class=\"btn btn_primary buy_cfrm_button\">ORIGINATE</button>` : `<button type=\"button\" id=\"publish\" class=\"btn btn_primary buy_cfrm_button\" disabled>ORIGINATE</button>`}\n            </div>\n            <p class=\"buy_note\" id=\"note_result\">${!user_addr ? 'Please, reload the page and connect your wallet to create haikus' : ''}</p>\n          </div>\n          <p class=\"buy_note\" id=\"note_result\"></p>\n        </div>\n      </div>\n    </section>`\n  }\n}\ntoken_close = () => {\n  document.getElementById('token_popup').innerHTML = ''\n}\n\nconst token_update_price = async (id) => {\n  document.getElementById(`sell_cfrm-${id}`).disabled = true\n  document.getElementById('note_result').innerHTML = 'Please, confirm transaction in your wallet'\n  contract = contract ? contract : await Tezos.wallet.at(contract_addr);\n  try {\n    const result = await contract.methods.token_update_price(Number(id), Number(document.getElementById('sell_amount').value), Math.ceil(Number(document.getElementById('sell_price').value) * 1000000)).send();\n    document.getElementById('note_result').innerHTML = 'Your request is in work. Wait some and update page to view changes.'\n  } catch (error) {\n    if (error.title == 'Aborted') {\n      document.getElementById('note_result').innerHTML = 'Please, try again and confirm transaction in your wallet'\n      document.getElementById(`sell_cfrm-${id}`).disabled = false\n    } else {\n      document.getElementById('note_result').innerHTML = 'Something went wrong, please try again later'\n    }\n    console.log(`The contract call failed and the following error was returned:`, error);\n  }\n}\nconst token_mint_complex = async (id) => {\n  document.getElementById('publish').disabled = true\n  document.getElementById('note_result').innerHTML = 'Please, confirm transaction in your wallet'\n  contract = contract ? contract : await Tezos.wallet.at(contract_addr);\n  try {\n    const result = await contract.methods.token_mint_complex(document.getElementById('mint_cont').value.slice(0, max_mint_length), Number(document.getElementById('mint_amount').value), 0, 0, 'en', parseInt(document.getElementById('mint_c_b').value.slice(1), 16), parseInt(document.getElementById('mint_c_t').value.slice(1), 16)).send();\n    document.getElementById('note_result').innerHTML = 'Your request is in work. Wait some and update page to view changes.'\n  } catch (error) {\n    if (error.title == 'Aborted') {\n      document.getElementById('note_result').innerHTML = 'Please, try again and confirm transaction in your wallet'\n      document.getElementById('publish').disabled = false\n    } else {\n      document.getElementById('note_result').innerHTML = 'Something went wrong, please update page and try again'\n    }\n    console.log(`The contract call failed and the following error was returned:`, error);\n  }\n}\nconst token_update_state = async (id, state) => {\n  document.getElementById(`update_button-${id}`).disabled = true\n  document.getElementById(`note_result-${id}`).innerHTML = 'Please, confirm transaction in your wallet'\n  contract = contract ? contract : await Tezos.wallet.at(contract_addr);\n  try {\n    const result = await contract.methods.token_update_state(Number(id)).send();\n    document.getElementById(`note_result-${id}`).innerHTML = 'Your request is in work. Wait some and update page to view changes.'\n  } catch (error) {\n    if (error.title == 'Aborted') {\n      document.getElementById(`note_result-${id}`).innerHTML = 'Please, try again and confirm transaction in your wallet'\n      document.getElementById(`update_button-${id}`).disabled = false\n    } else {\n      document.getElementById(`note_result-${id}`).innerHTML = 'Something went wrong, please update page and try again'\n    }\n    console.log(`The contract call failed and the following error was returned:`, error);\n  }\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", () => { alien_link = new URL(document.getElementById('alien_link').href).pathname; dom_loaded = true; main_start() })\ndocument.addEventListener('click', e => {\n  if (e.target.id == 'popup_overlay') token_close()\n  if (e.target.id == 'new_haiku_big_button' || e.target.id == 'new_haiku_button') {\n    new_haiku_open()\n  }\n  if (e.target.id == 'publish') {\n    token_mint_complex()\n  }\n  const id = e.target.id.split('-')\n  if (id[0] == 'sell_cfrm') {\n    token_update_price(id[1])\n  }\n  if (id[0] == 'update_button') {\n    e.stopPropagation()\n    token_update_state(id[1])\n  }\n})\ndocument.addEventListener('input', e => {\n  if (e.target.id == 'sell_amount') {\n    document.getElementById('sell_samt').innerHTML = `Selected amount to sell: ${e.target.value}`\n  }\n  if (e.target.id == 'sell_price') {\n    if (e.target.value < 0) e.target.value = 0\n    document.getElementById('sell_cost').innerHTML = `Selected price: ${e.target.value}tz`\n  }\n  if (e.target.id == 'mint_amount') {\n    if (e.target.value > max_mint_amount) e.target.value = max_mint_amount\n    if (e.target.value < 1) e.target.value = 1\n    document.getElementById('mint_samt').innerHTML = `Selected amount to mint: ${e.target.value}`\n  }\n  if (e.target.id == 'mint_c_b') {\n    document.getElementById('canvas').style.fill = e.target.value\n  }\n  if (e.target.id == 'mint_c_t') {\n    document.getElementById('image_text').style.fill = e.target.value\n  }\n  if (e.target.id == 'mint_cont') {\n    document.getElementById('image_text').innerHTML = e.target.value.slice(0, max_mint_length).split('\\n').reduce((a, c) => a + `<tspan x=\"10%\" dy=\"1.6em\">${c}</tspan>`, \"\")\n  }\n})\n"],"names":["_taquito","require","_beaconWallet","Tezos","TezosToolkit","rpc_addr","Wallet","BeaconWallet","name","setWalletProvider","contract","at","contract_addr","then","storage","assign_data","storage_loaded","check_wallet","catch","error","console","log","JSON","stringify","async","activeAccount","client","getActiveAccount","document","getElementById","style","display","user_addr","address","onclick","disconnect_wallet","location","reload","innerHTML","data_loaded","main_start","connect_wallet","permissions","requestPermissions","network","type","rpcUrl","clearActiveAccount","data","tokens","owners","reports","key","value","token","valueMap","id","Number","slice","amount","state","cnfrm_at","Date","crted_at","text_color","c_t","b","g","r","back_color","c_b","image","content","split","reduce","a","c","push","s_key","value1","ledger","key1","parse","token_id","owner","count","for_sale","price","value2","report","rep_t_id","dom_loaded","created","filter","creator","sort","t","rep","min_price","Infinity","cnfrm_by","length","rejct_by","min_voted_users","min_voted_time","yes_by","no_by","min_voted_on_report","voted_positive_percent","statuses_d","toGMTString","owner_tokens","owned","includes","t1","info_open","statuses","sell_open","o","max_amount","sale","alien_link","new_haiku_open","max_mint_amount","token_close","addEventListener","URL","href","pathname","e","target","disabled","wallet","methods","token_mint_complex","max_mint_length","parseInt","send","title","token_update_price","Math","ceil","stopPropagation","token_update_state","fill"],"version":3,"file":"account.5318c51a.js.map"}