!function(e,t,n,o,r){var a="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},d="function"==typeof a.parcelRequirecef0&&a.parcelRequirecef0,l=d.cache||{},s="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function i(t,n){if(!l[t]){if(!e[t]){var o="function"==typeof a.parcelRequirecef0&&a.parcelRequirecef0;if(!n&&o)return o(t,!0);if(d)return d(t,!0);if(s&&"string"==typeof t)return s(t);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}u.resolve=function(n){return e[t][1][n]||n},u.cache={};var c=l[t]=new i.Module(t);e[t][0].call(c.exports,u,c,c.exports,this)}return l[t].exports;function u(e){return i(u.resolve(e))}}i.isParcelRequire=!0,i.Module=function(e){this.id=e,this.bundle=i,this.exports={}},i.modules=e,i.cache=l,i.parent=d,i.register=function(t,n){e[t]=[function(e,t){t.exports=n},{}]},Object.defineProperty(i,"root",{get:function(){return a.parcelRequirecef0}}),a.parcelRequirecef0=i;for(var c=0;c<t.length;c++)i(t[c]);var u=i(n);"object"==typeof exports&&"undefined"!=typeof module?module.exports=u:"function"==typeof define&&define.amd&&define((function(){return u}))}({Zc8CS:[function(e,t,n){var o=e("@taquito/taquito"),r=e("@taquito/beacon-wallet");e("@airgap/beacon-sdk");const a=new o.TezosToolkit(rpc_addr),d=new r.BeaconWallet({name:"Tezos Haiku"});a.setWalletProvider(d),a.contract.at(contract_addr).then((e=>e.storage().then((e=>{l(e),check_wallet()})))).catch((e=>console.log(`Error: ${JSON.stringify(e,null,2)}`))),check_wallet=async()=>{const e=await d.client.getActiveAccount();e?user_addr=e.address:document.getElementById("buttons_preview").innerHTML+='<a class="btn btn_secondary right_down_space" onclick="connect_wallet()">Connect wallet</a>',data_loaded=!0,i()},connect_wallet=async()=>{const e=await d.client.getActiveAccount();if(e)user_addr=e.address;else{const e=await d.client.requestPermissions({network:{type:network,rpcUrl:rpc_addr}});user_addr=e.address}document.getElementById("buttons_preview").lastChild.remove(),data_loaded=!0,i()},disconnect_wallet=async()=>await d.clearActiveAccount();const l=e=>{data.tokens=[],data.owners=[],data.reports=[];for(const[t,n]of e.token.valueMap){n.id=Number(t.slice(1,-1)),n.amount=Number(n.amount),n.state=Number(n.state),n.cnfrm_at=new Date(n.cnfrm_at),n.crted_at=new Date(n.crted_at),n.text_color=Number(n.text_color);const e={b:n.text_color%256};e.g=(n.text_color-e.b)/256%256,e.r=((n.text_color-e.b)/256-e.g)/256%256,n.back_color=Number(n.back_color);const o={b:n.back_color%256};o.g=(n.back_color-o.b)/256%256,o.r=((n.back_color-o.b)/256-o.g)/256%256,n.image=`<svg class="" width="338px" height="225px" role="img" focusable="false">\n    <rect width="100%" height="100%" fill="rgb(${o.r},${o.g},${o.b})" rx="0.25rem" ry="0.25rem"></rect>\n    <text y="20%" fill="white" font-size="1.2em">\n      ${n.content.split("\n").reduce(((t,n)=>t+`<tspan x="10%" dy="1.6em" fill="rgb(${e.r},${e.g},${e.b})">${n}</tspan>`),"")}\n    </text>\n  </svg>`,data.tokens.push(n)}for(const[t,n]of e.ledger.valueMap){const e=JSON.parse(t);n.token_id=Number(e[1]),n.owner=e[0],n.count=Number(n.count),n.for_sale=Number(n.for_sale),n.price=Number(n.price),data.owners.push(n)}for(const[t,n]of e.report.valueMap)n.id=Number(t.slice(1,-1)),n.rep_t_id=Number(n.rep_t_id),data.reports.push(n)},s=(e,t)=>{const n=e.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split("\n").join(" ").split(" ").filter((e=>e.length>3)).reduce(((e,t)=>(-1==e.indexOf(t)&&e.push(t),e)),[]),o=t.toLowerCase().replace(/[.,\/#!$%\^&\*;:{}=\-_`~()]/g,"").split("\n").join(" ").split(" ").filter((e=>e.length>3)).reduce(((e,t)=>(-1==e.indexOf(t)&&e.push(t),e)),[]);return n.reduce(((e,t)=>e+o.includes(t)),0)},i=()=>{if(dom_loaded&&data_loaded){console.log(data.tokens),console.log(data.owners),console.log(data.reports),document.getElementById("tokens").innerHTML="";for(const e of data.tokens.filter((e=>0==e.state)).sort(((e,t)=>e.crted_at-t.crted_at))){const t=data.reports.filter((t=>t.rep_t_id==e.id));let n="";for(const t of data.tokens.filter((t=>e.crted_at>t.crted_at)))(!n||s(n,e.content)<s(t.content,e.content))&&(n=t.content);const o=s(n,e.content);e.cnfrm_by.length+e.rejct_by.length>=min_voted_users&&Number(e.cnfrm_at)+1e3*min_voted_time<=Number(new Date)&&(t.reduce(((e,t)=>e||t.yes_by.length+t.no_by.length>=min_voted_on_report&&t.yes_by.length/(t.yes_by.length+t.no_by.length)>=voted_positive_percent),0==t.length)||t.reduce(((e,t)=>e&&t.yes_by.length+t.no_by.length>=min_voted_on_report),!0))?document.getElementById("tokens").innerHTML+=`\n        <div class="card token">\n          ${e.image}\n          <div class="card-body">\n            <p class="card-text">Haiku #${e.id} written by ${e.creator==user_addr?`<a class="alien" href="${account_link}" target="_blank">you</a>`:`<a class="alien" href="${alien_link}?address=${e.creator}" target="_blank" style="font-family:monospace; font-size: initial;">${e.creator}</a>`}</p>\n            <div class="d-flex justify-content-between align-items-center">\n              <button type="button" id="update_button-${e.id}" class="btn btn-sm btn-outline-secondary verify_button" ${user_addr?"":"disabled"}>VERIFY</button>\n            </div>\n            <p class="buy_note" id="note_result-${e.id}">${user_addr?"":"Please, connect your wallet to vote for haikus"}</p>\n          </div>\n        </div>`:document.getElementById("tokens").innerHTML+=`\n        <div class="card token">\n          ${e.image}\n          <div class="card-body">\n            <p class="card-text" style="margin-bottom: 0;">Haiku #${e.id} written by ${e.creator==user_addr?`<a class="alien" href="${account_link}" target="_blank">you</a>`:`<a class="alien" href="${alien_link}?address=${e.creator}" target="_blank" style="font-family:monospace; font-size: initial;">${e.creator}</a>`}</p>\n          </div>\n          ${n&&o>=3?`\n            <div class="card-body plagiarism">\n              <p style="margin-bottom:5px;">Possible plagiarism of:</p><p style="margin-bottom:0;">${n.split("\n").join("<br>")}</p>\n            </div>`:""}\n          <div class="card-body">\n            <div class="voting">\n              <button type="button" class="btn btn_voting_good" id="good_vote-${e.id}" ${e.cnfrm_by.includes(user_addr)||!user_addr?"disabled":""}></button>\n              <div class="progress" style="width: 100%;margin: 5px;">\n                <div class="progress-bar" role="progressbar" id="voting_bar-${e.id}" style="width: ${e.cnfrm_by.length+e.rejct_by.length?e.cnfrm_by.length/(e.cnfrm_by.length+e.rejct_by.length)*100:50}%"></div>\n              </div>\n              <button type="button" class="btn btn_voting_bad" id="bad_vote-${e.id}" ${e.rejct_by.includes(user_addr)||!user_addr?"disabled":""}></button>\n            </div>\n            <p class="buy_note" id="note_vote-${e.id}">Total number of votes: ${e.cnfrm_by.length+e.rejct_by.length}. You have${e.cnfrm_by.includes(user_addr)?" voted for green":e.rejct_by.includes(user_addr)?" voted for red":"n't voted"}</p>\n            <p></p>\n            <div class="d-flex justify-content-between align-items-center">\n              ${Number(e.cnfrm_at)+1e3*min_voted_time<=Number(new Date)?"<p></p>":`<button type="button" id="report_button-${e.id}" class="btn btn-sm btn-outline-secondary buy_button">Report</button>`}\n              <small class="text-muted">${e.crted_at.toGMTString().split(", ")[1].slice(0,-7)}</small>\n            </div>\n            <p class="buy_note" id="note_result-${e.id}">${user_addr?"":"Please, connect your wallet to vote for haikus"}</p>\n          </div>\n          ${t.reduce(((e,t)=>e+`\n            <div class="card-body viol_cprt">\n              <p class="card-text">Possible violation of copyright!</p>\n              <p class="card-text">This is known haiku of <a style="font-family:monospace; font-size: initial;">${t.orig_author}</a></p>\n              <p class="card-text">Prove link: <a href="${t.orig_link}" target="_blank">proves here</a></p>\n              <div class="voting">\n                <button type="button" class="btn btn_voting_good" id="rep_good_vote-${t.id}" ${t.yes_by.includes(user_addr)||!user_addr?"disabled":""}></button>\n                <div class="progress" style="width: 100%;margin: 5px;">\n                  <div class="progress-bar" role="progressbar" id="rep_voting_bar-${t.id}" style="width: ${t.yes_by.length+t.no_by.length?t.yes_by.length/(t.yes_by.length+t.no_by.length)*100:50}%"></div>\n                </div>\n                <button type="button" class="btn btn_voting_bad" id="rep_bad_vote-${t.id}" ${t.no_by.includes(user_addr)||!user_addr?"disabled":""}></button>\n              </div>\n              <p class="buy_note" id="rep_note_vote-${t.id}">Total number of votes: ${t.yes_by.length+t.no_by.length}. You have${t.yes_by.includes(user_addr)?" voted for green":t.no_by.includes(user_addr)?" voted for red":"n't voted"}</p>\n              <p class="buy_note" id="rep_note_result-${t.id}">${user_addr?"":"Please, connect your wallet to vote for haikus"}</p>\n            </div>`),"")}\n        </div>`}}};report_open=async e=>{const t=data.tokens[e],n=data.reports.filter((t=>t.rep_t_id==e));document.getElementById("report_popup").innerHTML=`<section id="report_popup_overlay" class="overlay__">\n    <div class="container__">\n      <h1 class="fw-light buy_header">Report on Haiku #${t.id}</h1>\n      <div class="card token buy_image">\n        ${t.image}\n      </div>\n      <div class="buy_body">\n        <div class="buy_inputs">\n          <label for="real_author" class="buy_label">Please enter name of real author of this haiku</label>\n          <input type="text" class="form_range" id="real_author">\n          <label for="real_link" class="buy_label">Please past a prove link here</label>\n          <input type="text" class="form_range" id="real_link">\n        </div>\n        <div class="btn-group buy_btn_group" role="group">\n          <button type="button" onclick="report_close()" class="btn btn_secondary buy_cfrm_button">CANCEL</button>\n          ${user_addr&&0==n.filter((e=>e.reporter_adrs==user_addr)).length?`<button type="button" id="report_cfrm-${e}" class="btn btn_primary buy_cfrm_button">REPORT</button>`:`<button type="button" id="report_cfrm-${e}" class="btn btn_primary buy_cfrm_button" disabled>REPORT</button>`}\n        </div>\n        <p class="buy_note" id="note_result">${user_addr?n.filter((e=>e.reporter_adrs==user_addr)).length>0?"You have already sent report on this haiku":"":"Please, connect your wallet to report on haikus"}</p>\n      </div>\n    </div>\n  </section>`},report_close=()=>{document.getElementById("report_popup").innerHTML=""};const c=async(e,t)=>{let n=data.tokens[e];document.getElementById(`bad_vote-${e}`).disabled=!0,document.getElementById(`good_vote-${e}`).disabled=!0,document.getElementById(`note_result-${n.id}`).innerHTML="Please, confirm transaction in your wallet",contract=contract||await a.wallet.at(contract_addr);try{await contract.methods.token_vote_for_state(Number(e),votes.indexOf(t)).send();document.getElementById(`note_result-${n.id}`).innerHTML="Your request is in work. Wait some and update page to view changes."}catch(t){return"Aborted"==t.title?(document.getElementById(`note_result-${n.id}`).innerHTML="Please, try again and confirm transaction in your wallet",document.getElementById(`bad_vote-${e}`).disabled=n.rejct_by.includes(user_addr),document.getElementById(`good_vote-${e}`).disabled=n.cnfrm_by.includes(user_addr)):document.getElementById(`note_result-${n.id}`).innerHTML="Something went wrong, please update page and try again",void console.log("The contract call failed and the following error was returned:",t)}"yes"==t&&(n.cnfrm_by.push(user_addr),n.rejct_by.includes(user_addr)&&n.rejct_by.splice(n.rejct_by.indexOf(user_addr),1),document.getElementById(`note_vote-${e}`).innerHTML=`Total number of votes: ${n.cnfrm_by.length+n.rejct_by.length}. You have voted for green`),"no"==t&&(n.rejct_by.push(user_addr),n.cnfrm_by.includes(user_addr)&&n.cnfrm_by.splice(n.cnfrm_by.indexOf(user_addr),1),document.getElementById(`note_vote-${e}`).innerHTML=`Total number of votes: ${n.cnfrm_by.length+n.rejct_by.length}. You have voted for red`),document.getElementById(`voting_bar-${e}`).style.width=n.cnfrm_by.length/(n.cnfrm_by.length+n.rejct_by.length)*100+"%"},u=async(e,t)=>{let n=data.reports.filter((t=>t.id==e))[0];if(n){document.getElementById(`rep_bad_vote-${e}`).disabled=!0,document.getElementById(`rep_good_vote-${e}`).disabled=!0,document.getElementById(`rep_note_result-${e}`).innerHTML="Please, confirm transaction in your wallet",contract=contract||await a.wallet.at(contract_addr);try{await contract.methods.token_vote_for_report(Number(e),votes.indexOf(t)).send();document.getElementById(`rep_note_result-${e}`).innerHTML="Your request is in work. Wait some and update page to view changes."}catch(t){return"Aborted"==t.title?(document.getElementById(`rep_note_result-${e}`).innerHTML="Please, try again and confirm transaction in your wallet",document.getElementById(`rep_bad_vote-${e}`).disabled=n.no_by.includes(user_addr),document.getElementById(`rep_good_vote-${e}`).disabled=n.yes_by.includes(user_addr)):document.getElementById(`rep_note_result-${e}`).innerHTML="Something went wrong, please update page and try again",void console.log("The contract call failed and the following error was returned:",t)}"yes"==t&&(n.yes_by.push(user_addr),n.no_by.includes(user_addr)&&n.no_by.splice(n.no_by.indexOf(user_addr),1),document.getElementById(`rep_note_vote-${e}`).innerHTML=`Total number of votes: ${n.yes_by.length+n.no_by.length}. You have voted for green`),"no"==t&&(n.no_by.push(user_addr),n.yes_by.includes(user_addr)&&n.yes_by.splice(n.yes_by.indexOf(user_addr),1),document.getElementById(`rep_note_vote-${e}`).innerHTML=`Total number of votes: ${n.yes_by.length+n.no_by.length}. You have voted for red`),document.getElementById(`rep_voting_bar-${e}`).style.width=n.yes_by.length/(n.yes_by.length+n.no_by.length)*100+"%"}else document.getElementById(`rep_note_result-${e}`).innerHTML="Report for which we vote is undefined, please, try again later."};document.addEventListener("DOMContentLoaded",(()=>{dom_loaded=!0,i()})),document.addEventListener("click",(e=>{"report_popup_overlay"==e.target.id&&report_close();const t=e.target.id.split("-");"good_vote"==t[0]&&c(t[1],"yes"),"bad_vote"==t[0]&&c(t[1],"no"),"rep_good_vote"==t[0]&&u(t[1],"yes"),"rep_bad_vote"==t[0]&&u(t[1],"no"),"report_button"==t[0]&&report_open(t[1]),"report_cfrm"==t[0]&&(async(e,t)=>{document.getElementById(`report_cfrm-${e}`).disabled=!0,document.getElementById("note_result").innerHTML="Please, confirm transaction in your wallet",contract=contract||await a.wallet.at(contract_addr);try{await contract.methods.token_report(Number(e),document.getElementById("real_author").value||" ",document.getElementById("real_link").value||" ").send(),document.getElementById("note_result").innerHTML="Your request is in work. Wait some and update page to view changes."}catch(t){"Aborted"==t.title?(document.getElementById("note_result").innerHTML="Please, try again and confirm transaction in your wallet",document.getElementById(`report_cfrm-${e}`).disabled=!1):document.getElementById("note_result").innerHTML="Something went wrong, please update page and try again",console.log("The contract call failed and the following error was returned:",t)}})(t[1]),"update_button"==t[0]&&(async(e,t)=>{document.getElementById(`update_button-${e}`).disabled=!0,document.getElementById(`note_result-${e}`).innerHTML="Please, confirm transaction in your wallet",contract=contract||await a.wallet.at(contract_addr);try{await contract.methods.token_update_state(Number(e)).send(),document.getElementById(`note_result-${e}`).innerHTML="Your request is in work. Wait some and update page to view changes."}catch(t){"Aborted"==t.title?(document.getElementById(`note_result-${e}`).innerHTML="Please, try again and confirm transaction in your wallet",document.getElementById(`update_button-${e}`).disabled=!1):document.getElementById(`note_result-${e}`).innerHTML="Something went wrong, please update page and try again",console.log("The contract call failed and the following error was returned:",t)}})(t[1])})),document.addEventListener("input",(e=>{"real_author"==e.target.id&&(document.getElementById("real_author").value=e.target.value.slice(0,max_max_report_author)),"real_link"==e.target.id&&(document.getElementById("real_link").value=e.target.value.slice(0,max_max_report_url))}))},{"@taquito/taquito":"5iUTv","@taquito/beacon-wallet":"bh16y","@airgap/beacon-sdk":"d9VoF"}]},["Zc8CS"],"Zc8CS");
//# sourceMappingURL=verification.0e94367e.js.map
